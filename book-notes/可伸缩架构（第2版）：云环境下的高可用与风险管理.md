## 可伸缩架构（第2版）：云环境下的高可用与风险管理
> 李·艾奇逊

### 内容简介

本书是一本关于现代化软件架构的书。书中介绍了如何构建和更新你的关键应用程序来满足日益苛刻的数字化客户的需求。书中还介绍了如何实现高可用性，如何使用现代化的开发和运维技术来架构应用程序，如何组织开发团队让应用程序和业务获得成功，如何将系统扩展到最大规模，以及如何利用云计算的可用资源来迎接上述挑战。

如果你管理着软件开发人员、系统可靠性工程师、DevOps工程师，或者经营着一个拥有大规模应用程序和系统的机构，本书中所提供的建议和指导都能够帮助你，让你的系统运行得更加平稳和可靠。

### 推荐语

时刻考虑可能出现的故障情况，是构建大规模应用程序的一个关键因素。本书将帮助你学习如何做到这一点，以及如何在用户增长和公司发展过程中，依然保持应用程序正常运行。
——Patrick Franklin，American Express的EVP兼CTO，Google前工程副总裁

本书会告诉你，如何在应用程序（以及公司）不断扩张以满足用户日益增长的需求的同时，保证一切正常运转。
——Lew Cirne，New Relic公司CEO

### 译者序

互联网从一穷二白发展到今天，“可伸缩性”“水平伸缩”这些以前只有大型互联网公司才面临的技术挑战，现在几乎是任何一家互联网公司都需要想办法去解决的难题。

但是写好一个伸缩性良好的大规模分布式系统却很难。

但是在面对大规模系统时，我们首先要承认的是不确定性，即有很多我们想不到、料不到的事情会发生，一个边角的小错误都可能导致整个系统全面“雪崩”。因此，我们不能再把系统当作一个稳定的、确定的程序看待，而需要在设计时充分考虑到那些可能不确定的情况。

就是要改变管理整个系统的有效手段。随着系统规模的不断增长，之前的人工操作方式已经明显无法跟上机器的增长速度，规模增长所带来的可靠性、可用性问题时刻都在挑战着整个团队的极限。

如何有效地评估、预测、管理、监控一个大规模的系统，这件事本身已经变成一个复杂的系统性工程，需要有效的方法论、原则、工具及最佳实践经验的相应支撑。

当一个系统的规模开始扩张时，可用性往往是系统首先要面临的问题。在激增的流量面前，每一次系统处理缓慢、崩溃都会给公司的业务带来损失，因此理解什么是高可用性对系统保障来说至关重要。为了维持或提高系统的可用性，我们需要一套标准和手段来测量系统的可用性，从而在第一时间发现系统可用性是否发生了变化，并制定相应的解决方案。

构建大规模可伸缩系统的时候，需要先梳理清楚系统中存在哪些不确定性，把它们定义成风险因素并建立相应的风险模型，定期回顾并确保更新风险因素。在这之后，我们要针对每个风险因素制定相应的应对方案和措施，并持续对风险管理计划、缓和计划和容灾计划进行测试和评估，这样才能避免在风险发生时手忙脚乱。

但是，随着服务越来越多，如何管理各个服务、服务间如何通信，以及团队如何划分都是新的问题。随着业界在这些方面的经验越来越多，经过Netflix、Amazon等公司的实践和推广，微服务的概念出现，完善的解决方案和工具也开始出现。

云计算及各种云服务的出现为我们创造了无限的可能。我们无须再考虑硬件和场地的问题，无须再处理烦琐的运维事项，可以按照使用量来付费，甚至很多服务也无须自己搭建，可以直接使用云服务提供商提供的各种高性能、高可用服务。云计算给我们带来的是一种颠覆性的变化，不仅影响到我们的开发、运维、技术栈，而且更深远地影响到我们对技术和架构的思考方式，进而为创造更多商业价值提供可能。

本书作者Lee Atchison是New Relic的首席云架构师和布道师，负责领导公司基础设施产品的搭建，并且帮助公司设计了一个稳定的、基于服务的系统架构。他曾在Amazon担任了7 年高级技术经理，深刻了解如何设计基于云的、可伸缩的系统，也主导创建了AWS Elastic Beanstalk等产品。

愿以后的每个系统都是高可用、可伸缩的系统。

### 序

但是，通过充分运用Lee在本书中所写的各项技巧，我们逐渐克服了这些困难，并构建了如今稳定可靠的企业级服务。其中我们使用的一个工具，建立了可用性工程的四个级别：青铜、白银、黄金和白金。要达到青铜级，团队必须拥有风险模型及预定义的SLA标准。要达到白银级，团队必须能够监控风险模型中标识出来的问题，并使用比赛日的方式来解决。黄金级意味着风险已经被缓解。白金级如同CMM 5级一样，不仅系统可以自愈，而且我们关注于持续性的改进。我们首先集中精力对第一级的服务进行改进，然后上升到第二级的服务，逐步推进，最终使得所有团队都至少达到白银级，并且大多数团队通过了黄金级，甚至有几个团队达到了白金级。

### 前言

书中还介绍了如何实现高可用性，如何使用现代的开发和运维技术来架构应用程序，如何组织开发团队让应用程序和业务获得成功，如何将系统扩展到最大规模，以及如何利用云计算的可用资源来迎接上述挑战。
设计可伸缩架构的整个过程，远不只是知道如何处理大流量。

本书的目标读者包括构建和管理大规模应用程序和系统的软件工程师、架构师、技术经理及总监。如果你管理着软件开发人员、系统可靠性工程师、DevOps工程师，或者经营着一个拥有大规模应用程序和系统的机构，本书中所提供的建议和指导都能够帮助你，让你的系统运行得更加平稳和可靠。

如果你的应用程序持续宕机、运行缓慢或者不稳定，客户就会放弃你，转而寻找能够处理他们业务的竞争对手。

随着世界的变化，我们越来越关注SaaS服务、基于云计算的服务和海量数据应用程序，可伸缩性变得越来越重要。

我个人倾向使用“服务”这个术语，但我知道很多人更愿意使用“微服务”这个术语。因此，在与其他公司讨论时，这两个术语我都会使用，具体选择哪个取决于上下文环境。

没有一个商业化的企业能够以这种方式生存并且对待它的客户。我们必须为客户提供令人难忘的用户体验。应用程序必须在客户希望使用它们的任何时候都能工作，必须在所有的时间里都可以工作，一天24小时，一周7天。如果不是这样，我们就会让客户感到失望，失望的客户就会离开。

管理可伸缩性并不只是管理流量，还包括管理风险和可用性。

本书被组织成5个主要部分，每个部分都代表了面向可伸缩架构的主要原则

原则1. 可用性：维护现代化应用程序的可用性
现代化软件必须保持高可用性。客户不会容忍服务中断。如果你的应用程序在客户需要时不能工作，那么他们将不会成为你的长期客户。

第Ⅰ部分讨论了应用程序可用性对客户的重要性，以及它如何受到应用程序伸缩的影响。理解、测量和提高可用性是这部分的重点。

现代化的应用程序架构要求远离单体应用程序，而采用基于服务的架构。
无论是从伸缩流量的角度，还是从伸缩组织处理应用程序能力的角度来看，单体应用程序都很难进行伸缩。单体程度越大，更改应用程序的速度就越慢，能够处理和有效管理它的人员就越少，流量变化和流量增长对可用性产生负面影响的可能性就越大。

原则3. 组织：为现代化应用程序建立可伸缩性的组织
除非你的开发团队使用现代化的过程管理手段，否则你无法构建现代化的软件。这包括服务所有权责任和开发流程。

应用程序如何伸缩并不是最重要的，但如果你的开发团队的组织架构不支持可伸缩性，或者你的组织没有正确的文化来驱动更高的可用性和更大的可伸缩性，那么你就无法伸缩你的应用程序。
组织好你的团队，使其可以更好地支持你的可伸缩性需求，这会创造出一种文化，从而支持应用程序的可伸缩需求。

第Ⅲ部分的章节包括：
•  第6章，服务所有权——STOSA
•  第7章，服务分级
•  第8章，服务等级协议

我们必须学会如何管理风险，并将风险作为评估技术债务和对应用程序改进做出决策的一个工具。
理解风险、测量风险和根据测量的风险结果来确定行为的优先级，是构建一个具有高伸缩性、高可用性的应用程序的重要工具。

我们必须根据当前的需要，按需动态地分配和消费基础设施资源。
动态的基础设施，以及能够支持和优化动态基础设施的应用程序，是构建高伸缩性、高可用性的应用程序的一个关键架构组件。
动态的基础设施是公有云的基础优势。利用好公有云对于保证应用程序的高可用性至关重要。

•  Bjorn Freeman-Benson，在开始编写本书时，你就给了我很多支持，并且提供了加入New Relic的工作机会，让我能够去思考如何编写本书。我很高兴我们的友谊能够在一起共事之后持续至今。

你引导我进入这个新的角色，并帮助我从一个工程师和架构师成长为一个战略家、专家和思想领袖。谢谢你相信我，并在这条路上指导我。

### 第Ⅰ部分 原则1. 可用性：维护现代化应用程序的可用性

现代化的软件必须具有高可用性。客户不会容忍服务中断。如果你的应用程序在客户需要时不能工作，那么他们将不会成为你的长期客户。

### 第1章 理解、测量和提高可用性

如果你的系统有很多不错的功能但是没法使用，那么没人会关心你的系统本身如何。

在设计面向可伸缩的系统架构时，最重要的一个话题就是可用性。虽然有些公司和服务认为一定的宕机时间是合理且允许的，但是对于大多数业务来说，宕机不可能不影响用户的满意度，甚至最终会影响到公司的发展。

只有系统是可用的，才有可能让用户感到高兴并愿意使用你的系统。因此，系统可用性和用户满意度之间存在着直接且重要的联系。

### 可用性与可靠性

可靠性一般指一个系统的质量。通常来说，它意味着一个系统能够按照技术标准持续运行的能力。如果一个软件通过了所有的测试套件，并且基本完成了它应该做到的事情，那么我们可以说它是可靠的。

而我们所提到的可用性，一般指系统在其能力范围内执行任务的能力。系统是否运转正常？是否可以操作？是否可以响应？如果答案是“是”，那么系统就是可用的。
“我收到回复了吗？”
“回复及时吗？”

可靠性
系统是否具备无差错地执行预期操作的能力。
可用性
为了执行这些操作，系统当前可运行的能力。

一个计算2+3却得到结果6的系统，其可靠性很低。一个计算2+3却永远不返回结果的系统，其可用性很低。可靠性问题通常可以通过测试来修复，而可用性问题通常较难解决。

我们主要关注于如何设计高可用的系统架构。我们会假设你的系统是可靠的，假设你知道如何构建和运行测试套件

### 什么导致了低可用性

究竟是什么原因导致之前运行正常的系统，却慢慢变得不可用了呢？通常，这会有许多种原因。
资源耗尽
用户数量的增加会导致系统使用的数据量增加，从而可能导致系统资源耗尽，应用程序运行越来越慢并最终无法响应。

预期之外的压力变化
随着应用程序被越来越多的人使用，可能需要对代码和应用程序进行修改以支撑不断增加的压力。这些改动通常都是在最后一刻被草草实现，缺乏足够的考虑或计划，因此也增加了问题出现的可能性。

大量的个体共同协作会产生大量的流动行为，包括新功能、变更功能，或者只是一般的维护工作。开发和维护应用程序的人员越多，就会产生越多的流动行为，从而增加了相互之间产生负面作用的可能。

应用程序依赖的外部资源，例如，SaaS服务、基础设施或者云服务越多，由于这些资源导致的可用性问题就会越多。

但是大多数不断发展的应用程序最终都会面临可用性的问题。
可用性问题会增加你的经营成本，增加你的用户的成本，降低用户对你的信任度和忠诚度。如果系统一直存在可用性问题，你的公司不可能长期存活。

### 测量可用性

测量可用性对保证系统高可用非常重要。只有通过测量可用性，你才能了解应用程序当前的运行状况，以及检查可用性随时间发生的变化。
测量Web应用程序的可用性时，最常用的办法是计算用户可访问的时间百分比。

一个“4个9”的应用程序需要在99.99%!的(MISSING)情况下都是可用的，这意味着它在一个月里只能宕机4分钟。

从上面的示例中，我们可以看到前述网站的可用性百分比小于3个9（99.8795%!，(MISSING)近似于99.9%!）(MISSING)。对于一个要维持5个9的网站来说，每个月只能宕机26秒。

通常，对于简单的Web应用程序来说，3个9的高可用性是可接受的。通过表1-1可以看到，这表示每个月的故障时间不能超过43分钟。

测量可用性对于保证系统高可用十分重要，不管是现在还是将来。本节讨论了测量可用性的常用方法，并提供了一些如何选择合理的可用性的建议。

### 提高下降的可用性

保持系统高可用是一件很难的事情。可用性开始下降时，你应该做什么？你的应用程序可用性已经下降或者正在开始下降，而你需要提高它来保证让用户满意，你应该做什么？

你需要如何来避免可用性下降？以下是一些关键的步骤：测试并跟踪当前的可用性将手动流程自动化自动化部署过程维护和跟踪管理系统中的所有配置允许快速更改并进行实验，并且保证如果出现了问题可以轻松回滚以不断改进应用程序和系统为目标随着应用程序的变化和增长，将可用性作为一个核心问题来解决

要理解可用性发生的变化，你必须首先测量出当前的可用性是多少。通过跟踪系统可用及不可用的时间，计算出可用性百分比，可以帮助你了解一段时间内的可用性程度。通过这个值，你可以判断出可用性是在提高还是降低。你应当不断地监控可用性百分比，并定期收集结果。此外，你需要覆盖系统中所有的关键事件点，例如，更改系统配置或者升级的时候，这样可以了解到系统事件和可用性问题之间的关系，也能够帮你确定系统的可用性风险。

服务分级是一个可以帮助你管理系统可用性的工具。服务分级指的是为各个服务打上一些简单的标签，表示该服务对于系统的关键程度。这使得你和团队能够区分出哪些是至关重要的服务，哪些是很重要但非必需的服务。我们将在第7章深入讨论服务分级。

当你对系统进行了某项更改后，它对系统造成的影响可能有益，也可能有害。因此，仅允许使用可重复性的任务会给你带来如下好处：在实施更改前进行测试的能力。在更改之前进行测试，对于避免因为失误造成的故障来说至关重要。完全控制任务执行的能力。这使你可以在进行更改之前，对更改的内容和步骤进行完善。由第三方审查更改任务内容的能力。这降低了更改任务产生未预期结果的可能性。通过版本控制来管理任务的能力。版本控制系统可以让你清楚了解任务被更改的时间、人员以及原因。对相关资源进行更改的能力。通过更改来提高一台服务器的能力是很不错，但是如果能够将相同的更改，完全一样地应用到所有受影响的服务器上，能够为我们带来更大的价值。让所有相关资源保持一致的能力。如果你总是对资源（例如，服务器）进行临时的手动更改，那么它们之间会逐渐产生不同的行为方式。由于无法找到可比较的基准行为，这会增加诊断问题的难度。实施重复性任务的能力。重复性任务都是可审计的任务。对于可审计的任务，可以事后从整个系统层面分析其影响是积极的还是消极的。

总而言之，如果你不能重复执行一个任务，那么这个任务就没什么用。事实证明，自动化执行更改可以保持系统和应用程序的稳定性。这其中包括服务器配置更改、性能调优、重启服务器、重启任务、改变路由规则，以及升级和部署软件包。现在我们来看一些你应该使用的可重复任务的例子。

对于服务器的内容，不要“临时手动地更改某个配置变量”，而要使用自动化的方式来进行更改。

但是一种更好的、与现代化的最先进的配置管理最佳实践相一致的方法是，引入一个称为基础设施即代码（Infrastructure as Code）的概念。基础设施即代码包括，以一种标准的、机器可读的规范来描述你的基础设施，然后通过一个基础设施工具来传递该规范，该工具可以创建或者更新你的基础设施和配置以使其符合规范。Puppet和Chef等工具可以帮助你简化这个过程的管理。

如果有人需要对基础设施或者其配置进行更改，那么他们必须首先对规范进行更改，将更改提交到版本控制系统，然后通过基础设施工具来“部署”这次更改，从而更新当前的基础设施，使其与规范相匹配。通过这种方式，你可以：1. 确保基础设施的所有组件都具有一个一致的、已知的以及稳定的配置。2. 跟踪对基础设施的所有更改，以便在需要时回滚这些更改，或者用来帮助解决与系统事件和宕机相关的问题。3. 允许结对评审过程—一个类似代码评审的过程，以确保对基础结构的更改是正确和适当的。4. 允许创建重复的环境，以便使测试、准生产和开发环境保持与生产环境相同。

同样的流程适用于所有的基础设施组件。这其中不仅包括服务器及其操作系统配置，还包括其他的云组件、VPC、负载均衡器、交换机、路由器、网络组件，以及监控应用程序和系统。

这意味着，一旦有人不小心覆盖了之前的更改，服务又会出现问题，因为没有任何文档记录了这次更改。或者，其他运行相同程序的服务器也会遇到这个问题，因为它们没有进行这个更改。

一致性、可重复性以及对细节的专注，是成功执行配置管理流程的关键因素。我们这里所描述的标准的、可重复的配置管理流程，对于让你的大规模系统保持高可用性至关重要。

拥有一个高可重复的、高自动化的更改和升级流程，带来的另一个好处是允许你对更改进行实验。假设你需要对服务器进行一次更改，并且你相信这会提高应用程序的性能。通过自动化的配置管理流程，你可以做到以下几点：用文档记录你想要进行的更改。让经验丰富的人来审查这次变更，他们可以提出建议和改进措施。在一个测试或者预发布环境中进行测试。快速、简单地部署更改内容。快速检查结果。如果这次更改没有达到想要的结果，可以快速回滚到上一次的正常状态。

当拥有自动化的变更和部署流程时，[2]你可以对所有更改实现一个自动化的完备性测试。你可以使用浏览器测试程序来测试Web应用程序，或者使用一个合成测试程序来模拟用户的交互。

通过让整个流程自动化，你会对每次更改更加有信心，知道它们不会对生产系统造成负面的影响。

通常来说，你的应用程序会不断发生变化。因此，你的风险管理、风险缓和、应急方案以及恢复计划也需要不断进行相应的改变。

### 提高应用程序可用性的5个要点

如何才能避免这样的问题呢？如果我们能够预料到第三方系统可能发生故障，就可以在设计过程中考虑到这个故障发生的场景，从而发现我们的应用程序也会随之发生故障。这样，我们就能添加一些逻辑来检查第三方服务，在问题发生时删除图标，或者在问题发生时捕获错误，避免它传递下去并影响页面的其他部分。一次小小的检查和一些错误恢复机制，就可以帮助应用程序保持正常运行。否则，我们的应用程序就会经历严重的服务中断。

以下是5个你可以关注并且应当关注的要点，它们能够帮助你的系统在规模增长的同时保证高可用性：时刻考虑应对故障时刻考虑如何伸缩缓和风险监控可用性以可预期及明确的方式来处理可用性问题

正如Amazon的CTO Werner Vogels所说，“所有事情每时每刻都会失败”。你应当提前为应用程序和服务发生故障而做出计划。问题迟早会产生。不过现在，我们要讲的是如何解决它。

通过使用一些设计模式，例如捕获底层异常、重试逻辑和断路器，可以帮助你捕获错误并尽可能避免影响其他功能。

有些时候，拒绝式服务可能来自“友方”。例如，可能会因为应用程序的用户看到一个临时活动，而导致增加大量请求。或者，用户程序中的一个bug，可能导致他们向你的应用程序拼命地发送请求。如果这样的事情发生了，你会怎样做？流量突增会让你的应用程序宕机吗？你能否检测出这种问题，并通过限制请求的速度来降低或者消除其影响吗？

大多数Web应用程序的流量都是在不断增加的。一个今天产生一定流量的网站，明天可能会产生远比你想象大得多的流量。当你构建系统时，不要只考虑当前的流量，还要考虑未来的流量。

需要设计出能够增加数据库数量和容量的架构。考虑限制数据伸缩的原因。当数据库达到容量极限的时候会发生什么？你需要确认这些限制因素并在到达极限之前解决它们。应当能够很容易地添加额外的应用程序服务器。

这是否意味着整个页面都必须动态生成呢？显然不是。除了页面的登录/问候部分，其他部分都是静态的，通过CDN可以轻松地进行分发并节省你的计算资源。

通过将这些动态数据进行分组，并与静态内容加以区分，可以提高Web页面的性能，降低应用程序需要处理的动态数据量。这样可以提高可伸缩性，并最终提高可用性。

险管理中的一个部分是风险缓和。风险缓和指的是当问题发生时，我们知道如何去尽可能降低问题所带来的影响。缓和意味着即使当服务和资源不可用时，依然尽可能确保你的系统以最好的、最完整的状态工作。

如果没有风险缓和计划，当搜索服务失败时，可能会产生一个错误页面，或者返回不正确或无效的结果—不管怎样，它都会带来很差的用户体验。这个示例中的风险缓和计划可能是这样的：我们知道最受欢迎的T恤是红色条纹T恤，60%!访(MISSING)问网站的用户最终都停留在（并很可能最后会购买）这个商品上。因此，如果搜索服务停止了，我们可以显示一个“很抱歉”的页面，下方显示最受欢迎的T恤列表，其中就包括红色条纹T恤。这会鼓励遇到这个错误页面的用户，继续浏览别人曾经感兴趣的T恤。此外，我们还可以显示一个“下一次购买享受10%!折(MISSING)扣”的优惠券，这样就可以鼓励之前没有进行购买的用户，在搜索服务恢复正常后，继续回到我们的网站上进行购买。

要点4：监控可用性除非你看到问题发生，否则你不会知道应用程序中存在着问题。你应当确保对应用程序进行了适当的监控，以便可以从外部和内部两个视角来观察应用程序的运行状况。

服务器监控监控服务器的健康状况，并且确保它们始终在有效运行。配置变化监控监控系统配置的变化，以便确定它们对应用程序的影响。应用程序性能监控深入了解你的应用程序和服务，确保它们按照预期运行。人为测试从用户的角度来实时检测应用程序的运行情况，以便在用户真正发现问题之前发现它们。报警当问题发生时通知相关人员，以便使问题可以得到快速有效的解决，将对用户的影响降到最低。

如今市面上有许多非常优秀的监控系统，包括免费的和付费的服务。我个人推荐New Relic，它提供了之前提到的所有监控和报警能力。作为一款软件即服务（SaaS）的软件，它能够支持任何规模的应用系统的监控需求。

如果你对监控中所发生的问题置之不理，那么监控系统就毫无用处。这意味着当问题发生时必须发出报警，这样你才能有所行动。除此之外，你应当建立整个团队都遵循的流程，帮助诊断问题，并轻松修复常见的故障。

所有这些流程、办法以及支持手册都应该提前准备好，以便当服务出现问题时，值班人员能准确知道如何在不同的情况下进行操作，以便快速恢复服务。

### 做好准备

提前做好处理可用性问题的准备，是降低问题出现概率和严重性的最佳方法

### 第2章 两次失误的高度——预留从错误中恢复的空间

一次主数据库故障再加上一个管理不善的备份服务器，会让这一天变得糟糕。我们如何能避免这类可靠性问题呢？

### 两次失误的高度

换一种角度说，如果你能够在两次失误的高度飞行，即使发生了一次失误，也总有一次能够从失误中恢复的机会。

因为每个节点每秒只能处理300个请求，所以服务器现在已经过载。在当前情况下，或者给所有用户提供较差的性能，或者会丢掉某些请求，或者以其他形式无法提供服务。总之，你的可用性开始下降了。如你在图2-2中所见，如果系统失去了其中的1个节点，就无法继续提供完整的能力。因此，即使你以为能够从1个节点故障中恢复，但实际上却不能。你的系统现在是脆弱的。为了能够处理节点故障，你需要4个以上的节点。如果你希望能够处理1个节点故障，那么就需要5个节点。这样，即使5个节点中的其中1个出现故障，还剩下4个节点可以处理流量：

[插图]我们得到的教训是：即使你认为有冗余节点来处理各种故障情况，但是如果有两个或多个问题同时发生（因为问题都是有关联性的），就可能会根本没有任何冗余。这样的系统就容易出现可用性的问题。

5个节点可以处理单个节点故障，或者在维护或升级时允许单个节点不可用。6个节点可以处理多个节点故障，或者在维护或升级时，允许同时存在1个节点升级失败和1个节点不可用。

有些时候，很多问题看上去都是独立的，不太可能同时发生，但事实上它们却是互相关联的。这意味着在某些场景下，多个故障可能会一起出现。

随后发生了一件事：在数据中心的机房中，某个机架上的供电系统出现了问题，导致整个机架无法工作。通常在这个时候，你会意识到所有6个服务器都放置在同一个机架上。你是如何发现的呢？因为所有6台服务器都下线了，同时你的服务也完全无法提供了。所以也别提什么冗余了……

请确保仔细检查了隐藏的共享故障因素，它们可能会导致你精心准备的计划付之东流，为系统带来可用性风险。

场景5：故障循环故障循环指的是，当某个特定问题导致系统故障时，为了修复它，你需要或者不得不制造另一个更严重的问题。

这正是因为虽然你制订了备选计划，但并不意味着在需要时能执行它。同样的问题也会出现在我们的服务上。一次服务故障会不会因为导致其他看起来无关的问题，从而让我们难以修复？

请确保你的恢复计划在问题发生时能够实现。如果不能考虑问题间的依赖关系以及相应的解决方案，你就会面临可用性的问题。

### 管理你的应用程序

因为即使出现故障的是备份数据库，也并不意味着可以不管它。对待你的备份和冗余系统，应该像对待主系统一样认真，毕竟它们的重要性是一样的。
我经常跟朋友们说，“如果它跟生产环境有接触，那它就是生产环境”。不要认为生产环境中的任何事都是稳定可靠的。

### 航天飞机

让我们用一个独立、冗余、能够恢复多级错误的系统示例来结束本章。事实上，它也是第一个将冗余和故障管理思想发挥到极致的大规模软件系统。它让宇航员可以将生命托付给它。
没错，我指的就是美国航天飞机计划。

因此，如果4台计算机上的主软件之间不能就结果达成一致，它们会将决定最终结果的权利交给第5台完全独立的计算机。
这就是一个从上层角度隔离可能问题的高冗余、高可用的系统。

### 第Ⅱ部分 原则2. 现代化应用程序架构：使用服务

现代化的应用程序架构要求远离单体应用程序，而采用基于服务的架构。
无论是从伸缩流量的角度，还是从伸缩组织处理应用程序能力的角度来看，单体应用程序都很难进行伸缩。单体程度越大，更改应用程序的速度就越慢，能够处理和有效管理它的人员就越少，流量变化和流量增长对可用性产生负面影响的可能性就越大。

### 第3章 使用服务

设计可伸缩和高可用应用程序的关键之一，是采用基于服务或微服务的架构。传统的单体应用程序开发流程不具有让应用程序保持可伸缩性和高可用性的能力。

### 单体应用程序与面向服务的应用程序

面向服务的架构能够将一个应用程序拆分成多个不同的领域，每个领域由单独的团队来负责管理。这种职责隔离对于构建大规模应用程序至关重要，可使各个服务之间独立地完成工作，避免影响到系统中其他组中开发人员的工作。

面向服务的架构使你能够将任务分配给不同的团队，让它们关注于系统中不同的可伸缩和高可用需求，并让它们有信心知道，自己的决定会对整个系统产生合理的影响。

使用基于服务的架构，你可以将各个服务看作一个个黑盒，只有服务的所有者需要了解该服务内部的复杂逻辑，其他开发人员只需要知道服务所能提供的能力，而不需要知道它内部的工作原理。这种认知和复杂性上的隔离，能帮助你创建更大型的应用程序，并且能更有效地管理它们。

基于服务的架构比单体应用程序更容易测试，从而可以增加系统的可靠性。

### 拆分服务

每个服务都是一个独立的组件。这里的“独立”很重要，独立的服务必须满足以下几个条件。
维护自己的代码库
服务拥有自己的代码库，且区别于其他服务的代码库。
管理自己的数据
服务需要管理其自身数据的状态。服务之间唯一能访问到数据的方式就是通过定义的API，其他服务不能直接接触当前服务的数据或者状态信息。
向其他服务提供能力

单一所有者
每个服务只能由一个开发团队负责和维护。虽然一个团队可以负责和维护多个服务，但是一个服务只能由一个团队负责和维护。

### 深入了解服务

￼一个单独的服务应该由一个3～8人组成的开发团队来负责和运行。这个团队应该负责该服务的所有方面。

这样就减少了团队之间的依赖，使得独立的团队更容易运行系统和实现创新。
如之前所述，单个服务应该只由单个团队负责和运行。关键是要确定这个团队可以负责该服务的所有方面。这意味着这个团队要负责服务所有的开发、测试、部署、性能以及可用性等各个方面。

例如，之前所讨论的信用卡支付处理。限制对含有敏感数据服务的访问，可以降低数据暴露所导致的问题。像这种情况，你可以从物理上限制只有关键人员才能访问服务的相关代码、数据和系统。
除此之外，将敏感数据分成两个或多个服务，每个服务由不同的团队管理，也可以有效降低多个服务同时泄露数据的风险。

出于安全原因隔离数据
当你在处理信用卡支付时，信用卡号码本身可以被存储在一个服务中。而使用信用卡所必需的信息（例如，账单地址和CCV代码）可以存储在第二个服务中。通过将该信息分开保存在两个服务中，每个部分都由单独的团队负责，你可以避免任何员工无意或有意地将信用卡信息泄露出去，造成不当影响。

如图3-7所示，如果服务A试图直接访问服务B中的数据，而不是通过服务B的API，那么所有问题都会出现。这种数据集成会导致服务A和服务B过度耦合，并且维护数据和迁移模式时会出现问题。一般来说，如果服务A越过服务B的业务逻辑，直接访问服务B的数据，会导致严重的数据版本不一致和数据损坏问题。这种情况应该被严格禁止。

### 过犹不及

如果一个系统中存在过多的服务，可能会带来以下这些问题。
影响大局观
想要记住整个系统架构变得越来越难，因为系统变得越来越复杂。
更大故障概率
更多独立组件之间需要相互协作，导致故障发生的概率更大。
难以修改服务
每个独立服务的消费者都越来越多，增加了修改服务可能对使用者造成影响的可能。
更多依赖
每个独立服务都越来越依赖于其他的服务。更多的依赖意味着发生更多问题的可能。

### 找到适当的平衡

创建过多的服务会使单个服务变得异常简单，但是由于服务之间的交互，整体系统会变得异常复杂。我真的听说过，有些系统利用微服务来定义只是简单返回一个布尔值“是”或“否”的服务—这显然过于偏激。为服务准确定义合适的大小没有错，但是这取决于你的系统和公司的文化。最好的建议是，当你定义服务和架构时，时刻记得在复杂性上保持平衡。

确定服务大小的适当平衡，对于创建一个优化运维和管理的应用程序架构，以及保持应用程序的高可用性和可伸缩性来说，都非常重要。

### 数据分区

数据分区的含义有很多种。在本节中，它表示将数据根据其中的某些键划分到不同的数据段中，通常为了利用多个数据库来存储更大规模的数据集合，或者获得比单个数据库更高的访问速度。

一般来说，你应当尽可能避免使用数据分区。为什么？因为一旦像这样对数据进行分区，就可能遇到以下这些问题。
应用程序复杂性
增加了应用程序的复杂性。因为从现在开始，你在实际获取数据之前，需要先去计算数据存放在哪里。
跨分区查询
无法很容易地获取多个分区中的数据。这一点在做业务数据分析查询时非常有用。

### 及时处理增长的烦恼

如今大多数应用程序都经历着流量、体量、复杂性，以及开发维护人员数量的增长的过程。通常，我们会忽视这些增长所带来的问题，直到遇到瓶颈不得不开始解决它们。但是，到那个时候通常已经晚了。各种问题已经积压到很严重的程度，很多早期能够解决问题的简单技巧，到那个时候已经不再适用了。

### 如何确定故障

没有接收到响应
请求已经发出，但是没有接收到服务发回的响应。这可能是由于网络通信故障、服务出现问题，或者服务故障导致的。
接收响应很慢
请求已经发出，并且响应也接收到了。响应的内容正确，也在预期范围之内。但是，响应比预期到达时间晚很长时间才接收到。这通常表明服务或者网络压力过大，或者存在其他资源分配不合理的问题。

### 适当的行为

优雅降级指的是在当前服务缺少某个故障服务的结果时，可以通过降低工作量来尽可能地完成工作。

对于一个服务（或者应用程序）来说，即使因为依赖服务由于故障不能再提供所需数据，也应当尽可能地提供服务价值，这一点是非常重要的。

优雅补偿
有观点认为，如果请求没有返回足够有用的结果，那么也应该算作失败。除了生成一条错误消息，你还能做些什么为用户提供价值呢？
即使你无法完全满足用户的需要，但是按照为用户提供价值的方向去改进，这就是一个优雅补偿的例子。

显然只显示一个空白页是不合理的，因为这样对用户来说没有任何用处；显示一条错误消息（“对不起，发生了一个错误”）也不是一个好主意。

但是，你可以显示一个向用户道歉但同时提供网站上当前最流行产品链接的页面。虽然这并不是用户真正想要的，但是它给用户提供了一些价值，避免了仅仅显示一个突兀的错误页面的情况。

为什么应该尽早失败？有以下几个原因。
资源节约
如果请求注定失败，那么在它失败之前进行的所有工作都是徒劳的。如果这些工作包括需要多次调用依赖的服务，那么浪费这么多宝贵的资源却只能得到一个错误。
响应性
你越快确定一个请求会失败，就能越快地把这个结果返回给发起请求的一方。这使得请求方可以更快地做出其他决定。

现如今，没有任何正常的业务会有这样的需要（在这个环境中），因此这个请求本身显然是无效的。100,000这个值超出了这个请求的合理范围。
但是，账户服务很负责任地尝试去处理这个请求，于是处理、处理、不断地处理……
这个服务最终由于没有足够资源来处理如此巨大的请求，所以失败了。当处理了几千个账户后它停止了服务，并返回了一个简单的错误消息。

而发起无效请求的调用方服务，由于接收到了失败消息，于是决定重试这个请求，于是重试、重试、不断地重试。
账户服务不断地处理这几千个账户，将这些结果扔到了一个失败信息中。但是它不断在重复做这件事。

不断失败的请求消耗了大量的可用资源。随着过多资源被消耗，导致其他合法请求也开始排队，并最终导致整个服务出现故障。

如果能在账户服务处理请求前进行一个简单的检查（例如，检查请求的账户数量是否合理），就可以避免对资源的大量浪费。此外，如果返回的错误消息能够表明这个错误是永久性的，并且是由一个无效的参数所导致的，那么调用方服务能够看到这个“永久错误”的消息，也就不会再去重试一定会失败的请求了。

### 第Ⅲ部分 原则3. 组织：为现代化应用程序建立可伸缩性的组织

如果你的开发团队的组织架构不支持可伸缩性，或者你的组织没有正确的文化来驱动更高的可用性和更大的可伸缩性，那么你就无法伸缩你的应用程序。

组织好你的团队，使其可以更好地支持你的可伸缩性需求，这会创造出一种文化，从而支持应用程序的可伸缩需求。

### 第6章 服务所有权——STOSA

服务所有权——STOSA

探讨团队对服务的“所有权”的具体含义，以及为什么这种所有权是重要的。在本章中，我们会介绍服务所有权的意义，以及如何来实践由独立团队负责的服务架构。

### 由独立团队负责的服务架构

什么是“由独立团队负责的服务架构（STOSA）”？STOSA对于由多个开发团队来负责并管理一个或多个系统服务的大型组织来说，是一个重要的指导原则

•  你必须有一个基于服务或者微服务架构建立的应用程序。
•  由多个开发团队负责构建和维护这个应用程序。

•  应用程序中的每个服务必须分配给某个开发团队，由它们所有。哪个团队所有哪个服务应该有良好的文档记录，并且组织中的每个人都可以很方便地知道。
•  不允许有某个服务被分配给多个开发团队。
•  一个开发团队可能会负责多个服务。
•  开发团队负责管理服务的所有方面，从服务架构到设计再到开发、测试、部署、监控和故障处理。
•  服务之间有清晰的边界，包括文档编写良好的API接口。
•  服务拥有自己的数据。数据是服务的一部分。如果一个服务需要访问存储在另一个服务中的数据，那么它必须使用一个文档编写良好的API来访问这些数据。
•  各服务负责维护服务之间的服务等级协议，开发团队负责对服务进行监控和报警。

在一个基于STOSA的组织中，每个团队的大小是确定的（通常在3～8人之间）。如果一个团队太小，它无法有效管理某个服务。如果团队太大，管理团队的工作会太繁重。

应用程序的每个方面都有清晰的所有权，对于系统的任何一个部分，你都可以很容易地知道谁是负责人，以及有疑问、问题或者改动应该联系谁。

在图6-2中，服务之间没有清晰的所有权。如果你需要在服务C或者服务D中完成某些事情，不清楚谁应该为此负责。如果其中一个服务出现问题，应该由谁来响应？如果你需要让服务I来完成某些事情，你应当联系谁？缺少清晰的所有权和责任会让一个复杂系统变得更加难以管理。

### STOSA应用程序和组织的好处

一个基于STOSA的组织比一个非基于STOSA的组织，可以管理更大、更复杂的应用程序。这是因为STOSA可以在多个开发团队之间有效分散系统的复杂性，同时保持清晰的所有权和职责范围。

### “拥有”一个服务意味着什么

在一个STOSA组织中，服务所属的团队需要百分之百地负责服务的所有方面。这个团队可能需要其他团队的支持（例如，硬件运维团队），但是最终该服务是由这个团队来完全负责的。

部署
负责决定服务是否及何时需要升级，以及相关的部署工作，其中包括对所有服务节点的验证和回滚工作，以及保证部署过程中服务的可用性。
部署窗口
决定什么时间可以安全地进行部署。这涉及公司或产品范围的停服以及各个服务的时间窗口。
产品基础设施变更
服务所需的所有产品基础设施变更（例如，负载均衡器的设置和系统调优）。
环境
管理服务的生产环境，以及所有的开发、预发布以及预生产部署环境。
服务SLA
讨论、确定并监控SLA，以及保障服务满足SLA的相关工作职责。
监控
确保为服务的各个方面建立了监控，包括监控服务的SLA。还包括定期检查监控的情况。

突发事件响应
确保系统在出现故障时能够生成报警事件。安排轮流值班制度以及报警通知管理，确保团队中有人能够处理突发事件。确保对突发事件的响应速度能够满足之前定义的SLA。
报告
向其他团队（消费服务或者依赖服务）发送内部报告，以及管理服务的运行健康报告。

通常，这些方面中的一些不是由服务所属的团队直接处理，而是由公共的基础设施、工具、运维或平台工程团队负责的。然而，即使在由其他核心团队处理的情况下，确保这些行为被控制在满足其SLA和客户期望所需的水平，最终也是服务所属团队的责任。

通常，以下几项不是由所属团队负责，而是有一个公共的团队来处理。
服务器/硬件

所有生产环境和其他环境下需要的硬件和基础设施。这通常由一个运维团队、云服务提供商或者二者同时提供。

工具集
集中提供和管理团队需要的各种工具。这其中包括部署工具、编译和代码管理工具、监控工具、值班和突发事件响应工具，以及报告工具。

数据库
通常由一个公共团队来管理负责存储服务数据的硬件和数据库。但是，数据本身、数据模式以及对数据的使用，通常由服务所属团队来管理。

所有服务所属的开发团队都是平级的。它们统一由一些支持团队，包括运维、工具、数据库以及其他团队来提供支持。

在STOSA组织中，服务所属团队会负责该服务的所有方面。它们可能会依赖于核心团队或者支持团队，但是最终是由它们来处理该服务的所有问题，保证服务的正常运行。

例如，我们假设因为核心团队的部署工具问题导致服务部署失败，那么也应该由服务所属的团队来负责。虽然它们可能需要与开发工具的团队来沟通解决，但是最终对此负责的一定是这个团队。它们不能推托说“这是工具团队的错误”这样的话。因此，即使最后发现事实是这样，但是因为服务出现了故障，所以由负责这个服务的团队来承担责任。

### 使用核心团队和服务

只要服务团队满足其特定的需求，就不必强制它们使用这些公共基础设施组件。

如果团队选择不使用这些由其他团队支持的共享能力，实际上可能会为自己带来额外的支持问题。然而，关键是这个决定是服务团队自己做出的，并且必须考虑到它所带来的影响。

这种方式的一个优点是能带给核心团队动力和责任，让它们把服务团队当作真正的客户。如果不能为客户提供他们需要的功能，客户就会做出其他的选择。这可以为集中式团队提供强大的动力，从而为服务团队提供更高质量的产品。

### 小结

STOSA是一个重要的模型，用来确定各个开发团队应该如何拥有和管理服务。它描述了一种组织文化模型，使得构建和维护可伸缩的服务成为一种可能。

### 第7章 服务分级

这样所带来的级联影响会让你的整个系统都不可用，尤其是当一个非关键服务的故障导致了关键服务出现故障时，会带来非常恶劣的影响。

服务分级是与某个服务相关的标签，其表明了该服务对你的业务运营的关键程度。服务分级允许你管理应用程序的复杂性，并以一种分布式和有组织的方式来理解单个应用程序服务的重要性。

### 什么是服务分级

系统中的所有服务，不管它多大或多小，都应当被分配一个服务级别。以下内容会大致告诉你如何来为一个服务分配级别（你可以根据自己的业务需要来调整建议）。

1级服务
1级服务是系统中最关键的服务。如果某个服务出现故障会导致用户或者公司业务产生重大损失，那么应当考虑将这个服务定为1级。
以下是一些1级服务的示例。
登录服务
如果用户不能登录到你的系统，那么也就无法使用你的系统。
信用卡处理服务
如果用户不能使用他们的信用卡，他们就无法完成订单，你也收不到钱。
权限服务
不是所有用户对同一个功能都有相同的访问权限。如果权限系统出现故障，用户就无法访问他们相应的功能。
订单处理服务
如果用户无法支付并完成订单，那么你也无法收到钱，用户也无法收到商品。
1级服务的故障对于公司来说有重要的影响。

2级服务
2级服务对于业务非常重要，但是在关键性上不如1级服务。如果2级服务发生故障，会导致用户体验显著受到影响，但是不会让他们完全无法使用你的系统。
2级服务也会显著影响你的后台服务流程，但是可能不会直接对用户造成影响。以下是一些2级服务的示例。
搜索服务
用户希望能够在你的站点上搜索产品和信息。如果没有搜索功能，他们仍然可以使用你的网站，但影响某些功能的使用。
订单结算服务
在仓库中处理订单并将订单发送给用户非常重要，但是用户不会注意到在完成订单时出现了短暂的停机。
2级服务的失败会对用户产生负面影响，但是不会导致系统完全失败。

3级服务
3级服务会对用户造成较小的、不容易注意到的，或者很难发现的影响，或者对你的业务和系统造成有限的影响。
以下是一些3级服务的示例。
用户头像服务
在网站页面上显示客户图标或者头像的服务。如果它无法工作，大多数人可能不会注意到。如果他们注意到了，也不是什么大问题。

4级服务
4级服务即使失败，也不会对用户体验造成任何严重的影响，更不会对业务或者资金方面造成任何严重损失。
以下是一些4级服务的示例。
销售报告生成服务
生成每周销售报告的服务。虽然销售报告很重要，但是生成服务的短暂故障不会造成任何严重影响。

### 示例：在线商店

看着图7-4，从描述中想象一下每个服务的职责，并想象一下当服务出现故障时用户可能或应该面对的体验。服务级别应该与用户体验保持一致。

分类搜索服务（2级）
这个服务处理来自用户的搜索请求，并返回匹配搜索项的商品列表。
这是一个2级服务，因为虽然搜索对网站来说是很重要的功能，但是没有它，用户依然能够在网站上浏览商品，直到搜索服务恢复。用户体验会被显著削弱，但是网站依然可用。

分类数据库服务（1级）
这是存储分类数据本身的数据库服务。
这是一个1级服务，因为如果没有分类数据库，网站就无法显示任何商品。

订单快递（3级）
这是打包并快递用户订单（一个很简单的例子）的服务。没有该服务，你的用户就无法收到他们购买的订单。
这看上去可能应该是一个1级服务，因为快递订单对于业务来说很关键。但是我们可以这样想一想：如果你一个小时无法快递订单，对用户会造成什么样的影响呢？对你的业务会造成什么影响呢？大多数情况下，它对用户造成的影响非常有限—一个小时的延迟并不会影响用户接收到他们的包裹的时间。它可能对你的业务有一些影响，因为负责打包订单的雇员可能会在一段时间内无法工作。因为它对业务有一些不严重的影响，也不会对用户造成严重的影响，所以3级的标签是合适的。

现在你已经了解了各个服务分级，应该能够对应用程序中的所有服务使用适当的服务分级标签了。既然我们的服务已经标记了标签，那么如何使用这些标签，以及它们会带来什么价值呢？

### 使用服务分级

关键依赖
如果你确定你的依赖是关键依赖，那么作为一个服务的开发人员，你需要小心处理依赖发生故障的情况，避免对服务造成严重的影响。
如果关键依赖出现故障，你的服务应当仍然能够尽力提供功能。因为依赖服务的级别比较低（数字较高），意味着它无法拥有同当前服务一样的可用性和可靠性。

如果PSCC服务（2级服务）不能提供服务呢？网站前端服务（1级服务）仍然必须尽可能地提供功能。那么，这个时候它应该怎么办呢？
它需要优雅地处理来自PSCC服务的失败消息（或者响应丢失）。一旦它确定PSCC服务发生故障，它需要立刻决定如何来显示产品详情页面。以下是一些备选项：
•  它可以在页面上使用之前缓存的价格（如果之前缓存过的话）。
•  它可以显示产品详情页面，但是不显示当前价格。它可以显示例如“无货”或者“当前价格未定”，或者甚至“添加商品到购物车中以查看当前价格”的消息。

我们称这种办法为优雅降级

非关键依赖
如果你确定你的依赖是非关键依赖，那么你几乎可以忽略这个依赖的服务失败。
这是因为你的依赖服务拥有更高的服务级别（数字较低），因此也会拥有比你的服务更高的可用性和响应性。

因为订单管理服务是一个1级服务，它的任何问题都需要非常快速地被处理，因此响应性和紧急性都非常高—远高于对订单周报服务失败的处理。
因此，当订单管理服务出现故障时，根本不需要对订单周报服务做任何特殊处理，因为如果订单管理服务不可用，周报服务不可用也是正常的。

### 小结

服务级别为服务所有者、依赖服务和用户提供了一种展现服务关键性的便捷方式，从而让它们可以轻松地理解和沟通服务之间的各种期望。这种简易性降低了出错的概率，并且服务级别建立的简单模型，让人们对服务之间的沟通变得更加容易。

### 第8章 服务等级协议

服务等级协议（SLA）的核心内容就是期望管理。如我们在第7章所讨论的，每个人对服务的期望都是不同的。许多期望都与服务的级别相关，但是如果我们更深入了解的话，这些期望会更加具体。
本书中讨论的服务等级协议，并不是公司和用户之间的法律或合同协议，这是团队和服务所有者之间的协议，它们提供了一个沟通服务间期望的机制。

SLO（服务水平目标）

SLA用来描述对外部客户的法律承诺，而SLO用来描述团队之间服务度量的目标。

然而，我不同意这点区别。因为从我的立场来看，这种区别通过一个似乎缺少承诺的术语（SLO）淡化了服务对服务承诺的重要性，SLO似乎比SLA描述的承诺更弱。这才是问题的核心。在我看来，一个团队的某个服务对另一个团队的另外一个服务做出的性能承诺，应该与对客户的法律承诺同等重要。因此，我将SLA一词用于客户协议和内部服务之间的承诺。
由于这些原因，在本书中，特别是在本章中，你可以放心地认为SLO和SLA这两个术语大部分时间是可以互换的。

我们将讨论SLA，以及它在外部客户和内部客户中的使用。我们将讨论如何将SLA作为一种在各个服务团队之间获得信任的方法，以及如何使用SLA来解决团队之间的问题。

### 什么是服务等级协议

服务等级协议（SLA）是一个提供某种级别可靠性和性能的承诺，用来在服务所有者和用户之间创建一个牢固的合约关系。

通过“用户的期望”这个例子，每个期望都可以表述成一个SLA。例如：
可用性
用户希望网站随时可以访问。你可以将这一点描述成网站可运行的最小时间百分比。例如，一个可用性SLA可能会这样描述，“我们的商店至少99.4%!的(MISSING)时间是可用的”。
加载时间
用户希望页面快速加载—即希望网站看上去是立刻响应的。你有很多种方式来描述这一点，但是最简单的方式是用页面需要加载的最长时间—例如，“99%!的(MISSING)时间页面会在4秒内加载”（请参考本章后面的“排名SLA”小节）。

以上所有这些都是SLA的例子。虽然它们之间存在很大区别，但是目的都相同，就是描述用户对系统的期待是什么样子的。

有时用户会与公司签订协议，要求满足一定的SLA要求，如果没有满足，可能会有一些赔偿或者其他规则。
例如，Amazon的AWS就与用户签订了SLA，如果它没能满足这些SLA，会提供一定的经济补偿。
以Amazon EC2为例，如果AWS的月运行时间低于99.95%!，(MISSING)它会给受影响的用户提供10%!的(MISSING)费用减免。如果低于99.0%!，(MISSING)它会给予30%!的(MISSING)费用减免。[1]

### 外部SLA与内部SLA的对比

对于复杂的多服务系统来说，内部SLA对系统的健康和可运维性至关重要。[2]为什么这么说呢？显然，如果服务所依赖的服务没能达到SLA要求，你也就无法保证自己服务的SLA。[3]
如果所依赖的服务只能够在90ms后返回响应，那你如何将响应速度提升到50ms呢？
如果所依赖的服务只能提供90%!的(MISSING)可用性，那你如何让自己的服务提供99%!的(MISSING)可用性呢？

只要它们能够保证自己的SLA，你也可以保证你的SLA。
你可以通过不断监控其他团队的性能是否达到SLA要求，来了解它们的运行情况。如果它们能够持续满足承诺的SLA，你就会对依赖的服务更有信心，从而可以将更多精力关注在自己的服务上，只需要保证继续满足对用户20ms的承诺。

### SLA可以用于问题诊断

SLA还提供了一种检测复杂系统中是否存在问题的方式。如果某个服务正在经历各种问题，首先就要检查它的依赖服务是否满足了SLA。如果某个依赖服务没有满足自己应该达到的SLA，你就可以先从这点开始，逐步诊断服务发生问题的原因。

意识到这很可能是导致你的服务性能问题的原因后，你开始跟踪其他团队解决问题的进展。这比花费大量宝贵时间寻找自己服务的问题更有意义。
通过与依赖服务建立定义良好的SLA，当你自己的服务或者依赖服务出现问题时，你可以非常容易地定位问题发生的原因。

### SLA的性能检测方法

以下是一些常见的性能检测方法。
调用延迟
这种方法用来测量服务需要多长时间来处理一个请求并返回响应。测量结果通常以微秒或者毫秒计算。

流量
这种方法用来测量服务在一段时间内能够处理多少请求。通常按照每秒有多少请求数量来测量

运行时长
这种方法用来测量服务正常、无故障运行的时间。通常以百分比计算，它可以测量服务在一段时间内（通常以天、月或者年计）的可用性。

错误率
它用来测量服务在一段时间内出现过多少次失败。通常以百分比计算，通过一段时间内失败的请求数除以请求总数得出结果。

TP90低于20毫秒
我们可以将其读作“90%!的(MISSING)请求在20毫秒以内处理”。


TP90
这表示90%!的(MISSING)延迟都低于该值。在本例中，90%!的(MISSING)数据就是18个数据点。除去最高的两个数据点（45毫秒和32毫秒），只剩下18个数据点，其中最高值是30毫秒。因此我们说TP90是30毫秒。

例如，在这个示例中，你的服务的SLA可能如下：
TP90<35毫秒
如果做到了这一点，那么服务就满足了自己的SLA。

SLA有时可能以另一种度量方式作为条件来表示。例如，某个服务可以保证一定的延迟，但是必须是在合理时间的前提下。因此，一个SLA可能有如下表示：
当流量<250,000请求/秒时，调用延迟TP90<25毫秒


### 究竟应当定义多少内部SLA，以及定义哪些内部SLA

你应当确保SLA覆盖了服务的所有关键部分，为所有的主要功能都定义合适的SLA，尤其是在对业务至关重要的地方。
你应当与服务的消费方一起来协商SLA，因为不能满足消费方需求的SLA就是一个无用的SLA。但是，尽量对所有的消费方都使用一样的SLA。服务应当尽可能用一套SLA来满足所有消费方的需求，因为为每个消费方都建立一组SLA，不仅会极大增加复杂性，而且不会带来任何实际的价值。

你应当只定义那些实际中可以实现监控和报警的SLA。如果你无法有效地验证SLA，定义它也没有任何意义。此外，应当关心服务是否违反了SLA，因为这应该是问题发生的最先表现，因此你需要确保当服务不满足SLA时可以第一时间接收到相关报警。

你应当建立一个包含所有SLA和监控的仪表盘界面，这样一眼就可以发现正在发生的问题。并且你应当将这个界面共享给所有的依赖方，这样它们也可以看到你的服务情况。
除此之外，你需要确保可以访问到所有依赖服务的仪表盘界面，这样你可以监控它们是否正在发生问题，以确定问题是否会影响到你的服务。

### 为什么内部SLA很重要

内部SLA的目的不是为了增加数字，而是为当前服务和其他依赖服务提供指导，帮助在团队之间设置合理的期望。

内部SLA是扩展应用程序规模的一个关键组件，这样你在开发和管理应用程序时才可以利用更多的开发团队。它改进了复杂性的伸缩能力和整个应用程序的可用性。

### 第Ⅳ部分 原则4. 风险：现代化应用程序的风险管理

同样存在“未知的未知”—即我们不知道自己不知道。

所有的复杂系统都存在风险，这是所有系统不可避免的一个部分。我们不可能消除一个复杂系统（例如，一个Web应用程序）中的所有风险。但是，检查风险并确定对风险的接受程度，对于保持系统健康非常重要。

但是这些方案都是有成本的。是否值得投入资金加固电线？是否值得将电线埋入地下？相比风险所带来的损失，这些降低风险的投入是否值得？这些问题都属于风险管理问题，也是我们要讨论的问题。
我们将从描述风险管理的基础开始，包括两个非常重要的概念，可能性和严重性。

### 第9章 如何在设计可伸缩架构时使用风险管理

第9章
如何在设计可伸缩架构时使用风险管理

风险管理包括确定系统中风险的位置，确定哪些风险必须消除、哪些风险可以暂时存在，以及如何降低这些留存风险发生的可能性和严重性。

风险管理就是在消除风险的成本与风险发生的成本之间保持平衡。

### 识别风险

风险管理的第一步就是列出所有已知的风险，以及它们的危害性和发生的可能性。
我们称这个列表为风险模型，稍后图9-1会展示一个风险模型的例子。
最初的风险模型的创建需要团队的头脑风暴。你可以从以下多个来源收集风险模型：
•  开发人员的头脑风暴
•  已知的重点售后支持问题
•  已知的安全风险和漏洞
•  已知的系统不完善或者缺失的能力
•  已知的性能瓶颈点
•  已知的流量峰值和变化
•  来自业务负责人、支持人员或者用户的特殊考虑
•  已知的系统技术债务

一旦你识别出了高危风险，请将它们加到风险计划中，并定期检查它们是否依然存在。

风险缓和
对于每个风险，不管它们是不是最危险的，我们都应当尽可能地去思考有没有降低风险发生概率或者风险影响程度的办法。这些办法被称为风险缓和措施。

风险缓和措施的价值很高，你需要重点发现那些既能够降低风险（不管是严重性还是发生概率）又易于实现或成本合理的措施。
我们以图9-1中的“如果用户身份服务停止服务会导致前端无法展现”的风险为例，一个可能的风险缓和措施是缓存某些用户身份信息，这样即使用户身份服务不可用，前台也可以将这些信息显示出来。

如果你不定期检查风险模型，它就会慢慢失去作用。你的团队应当至少每个季度都对风险模型进行检查，对于非常活跃及极其关键的系统的风险模型可能需要每月进行检查。

如何管理系统中的风险？以下是一些你可以用来参考的基本步骤。
识别风险
首先，创建一个系统中已知风险的列表，即风险模型。对列表中各个风险事项排列优先级。
消除最严重的风险
找出列表中最大的风险，制订相应的解决计划。
风险缓和
对于无法暂时解决的主要风险，制订一个缓和计划来降低风险发生的可能性和严重性。
定期检查
定期检查你的风险模型。

### 可能性与严重性

风险的重要程度就是风险发生的严重性与可能性两者之和。如果要成功地管理风险，你必须同时考虑两者以及它们之间的关系。为了降低风险，你需要至少降低其中之一，或者严重性，或者可能性。

考虑到高严重性，你也许会希望采取措施来降低这个风险的严重性。例如，你希望使用一个从数据库，作为主数据库的实时副本，这样当主数据库发生故障时，可以快速让从数据库作为主数据库使用，避免大量时间和数据上的恢复工作。另外，你还可以采用分布式数据库，将数据分散到多台服务器上，这样即使其中一个数据库服务器发生故障，整个集群还可以提供服务。

•  因此，这是一个高/高风险，意味着它的可能性很高（硬件经常故障）并且严重性也很高（用户不会进行购买）。
这种类型的风险最为严重，因为它发生的概率很高，并且会对业务产生严重的影响。
你最应该关注这一类风险。

### 风险模型

风险模型是管理系统中风险的一个关键方面。它是一张包含了系统所有已知风险的当前状态的表格。

风险模型包含了以下风险项。
风险ID（Risk ID）
这是每个风险的唯一标识。它可以是任何类型的，但通常选择唯一的整数标识，这是最简单的方式，也能够满足需要。[1]
系统（System）
这是包含风险的系统、子系统或者模块的名称。这个值取决于你对应用程序的定义和划分，通常会是类似“前端”“主数据库”“服务A”的值。
所有人（Owner）
负责该风险的个人（或者团队）的名称，所有人同时也负责制订该风险的缓和计划和解决计划。

严重性（Severity）
表示风险发生的严重性或者影响（分低、中、高三级）。我们在本章前面的“可能性与严重性”一节中已经详细讨论了这个值，你可以使用这个值对风险模型进行排序，确定哪些是最需要关注和立即解决的风险。
风险缓和计划（Mitigation Plan）
这一列描述了可以使用的或者正在使用的用来降低该风险严重性或者可能性的风险缓和措施。
状态（Status）
该列表示该风险的当前状态。这个值通常是“活跃”“已缓和”“正在修复”或者“已解决”等内容。
ETA
表示该风险距离计划解决日期（如果有的话）的估计时间。

我推荐为每个团队提供一个风险模型。因为通常由团队来决定要完成的功能或问题，以及它们的优先级，所以也应当从团队层面来管理风险模型，由团队来决定其中各项风险的优先级。你可以在第6章了解更多从团队层面来管理风险的内容。

最后，你应当根据组织架构来设定风险模型的作用域。例如，每个团队、小组或者组织各自使用一个风险模型，来管理自己的工作范围和优先级。它们可能从上级管理部门接受任务和指导，但是会自己来决定大多数工作的优先级和执行内容。

通过头脑风暴建立风险列表
当你准备好模板后，第一步是通过头脑风暴得到一份风险列表。你应当试着把所有你能想到的风险都列出来，而不仅仅是那些你关心的风险。在这个过程中不要去分析它们，只要把它们尽可能都列出来就可以了。

性能
思考一下系统的性能情况。有没有性能较差的地方？
业务负责人
与业务负责人进行一下交谈。他们有什么顾虑？

技术债务
你的团队中有没有已知的、明确的技术债务？这些技术债务包括难以理解的、过于复杂的，或者过于冗余的代码。已知的技术债务通常都是风险项。

缓和计划
你需要从严重性最高的风险项开始，制订它们的风险缓和计划。然后再从可能性最高的风险项开始。

触发计划
触发计划指的是当风险真正发生时你需要采取的措施。这可能会像“修复缺陷”这样简单的描述，也可能是更详细的描述。例如，如果发生了某个风险，是否有一些可以立即执行并降低影响的措施？如果有，它们也应该被加入触发计划。

当你创建了风险模型后，所有的计划会议都应该参考它。这不仅包括产品管理的长期计划会议，也包括与工程师一起进行的敏捷开发计划会议。
在每个计划会议中，应该检查最重要的一些风险。[4]会上应当询问的问题列表如下所示：
•  与上次检查相比，这个风险现在是不是更严重了？
•  是否应该在这次计划排期中，安排人员来解决某些风险？
•  是否应该在这次计划排期中，安排人员来执行缓和风险的措施，降低它们的可能性或者严重性。

风险模型的最大挑战是模型本身很容易过时。我们的天性会让我们建立完模型后，将它扔到某个抽屉中并遗忘它。
如果你不花时间来维护风险模型，那么它很快会变得过时和无用。

为了始终保持风险模型的内容及时准确，你应该与相关权益人（包括开发团队和合伙人）定期对它进行检查。这个时间可以是每月，但不应该超过一个季度。确切的重复周期应该根据你的业务流程来制定。如果你马上要进入一个计划周期，那么在周期开始前进行一次定期的模型检查是最理想的情况。

在整个管理大会上，根据这个核心的“高/高”风险列表来讨论公司所有产品的风险，统一不同团队对风险模型的理解，并积累最佳实践经验。

### 恢复计划

恢复计划是风险缓和的一种特殊类型，专门用来降低风险发生的严重性。恢复计划描述了一个已知风险发生后你应该采取的行为，包括以下几种：
•  尽可能迅速地停止导致问题的行为。
•  降低问题影响的临时行为。
•  通知用户问题情况，以及他们可以采取的降低影响的行为。
•  上报问题的流程，以及需要通知的公司内部人员（这能够让公司统一了解问题情况，一起处理问题和任何可能带来的波及影响）。
一个好的恢复计划，一定是作为风险缓和计划的一部分提前制订的，因此当问题真的发生（触发）时，每个人都知道应该做什么来恢复问题。

恢复计划应该保存在团队都知晓的地方，即当危机发生时每个人都知道在哪里能找到它。这个地方可以是支持手册或者内部支持网络上。当执行某个恢复计划之后，应该对故障进行事后分析，同时也应该对恢复计划进行分析，以决定是否存在任何改进的措施，或者确保所有改动都经过批准。

### 容灾计划

容灾计划是一种恢复计划，主要用来描述当某种灾难发生时公司应该采取哪些措施。这类灾难通常严重性很高，但是可能性很低。
一个符合容灾计划的灾难例子就是，一个或多个数据中心不可用（不管是由技术问题、自然灾难还是严重安全漏洞导致的）。
你可以像建立恢复计划那样建立和管理容灾计划。二者之间唯一的区别在于要缓和的风险的严重性、细节程度以及执行计划的投入。

### 第10章 比赛日

我们经常犯一个危险的习惯性错误，就是建立恢复计划和容灾计划后，将它们搁置在抽屉里，只有在需要的时候才会想起它们来。
如果你真的这样做，我几乎可以保证，当你需要恢复/容灾计划的时候，它们已经过时了。除此之外，如果你不保持更新它们，就可能引入大量其他的问题，导致计划无法执行，或者在实际中无法成功执行。
因此，你应该定期对恢复/容灾计划进行测试。应该把定期测试这些计划和其他风险缓和措施，作为你的公司文化的一部分。

### 预发布环境和生产环境

•  确保预发布/测试环境与生产环境是完全隔离的。这个环境不应该依赖任何生产资源，生产资源也不应该依赖任何测试环境的资源。请参考图10-1。

•  确保预发布环境和测试环境与生产环境尽可能保持一致。虽然使用预发布/测试环境来测试恢复计划是可行的，并且你也可以使用这类环境来测试各种破坏性的故障场景，但是，它们并不能保证在生产环境中一定得到相同的结果。

在理想情况下，测试环境应该达到跟生产环境一样的规模，并且使用与生产环境一样的数据，但是，这通常在成本和维护方面无法实现。
如果你认为某个测试必须在与生产环境规模一样的情况下进行测试，那么也许应该考虑在生产环境中进行测试。

在生产环境下测试风险和恢复计划看上去没有道理。为什么要强制让生产环境出现一次故障，只是为了确定它不会发生故障？答案很简单：你在团队就绪并且准备充分的情况下（换句话说，不是在午夜），同时在一个对用户影响最小的时间点上，在仔细考虑测试的每个步骤后，可以安全地在生产环境下进行实际测试，从而了解恢复真正故障所要付出的努力。

•  选择你的团队成员状态最好的时刻（通常是工作日白天大家都在办公的时候）来进行测试，但是也要选择对用户影响最小的时刻（例如，选择流量较低的时候，而不是在月底或者季度末销售高峰等关键时刻）。
•  确保你能够快速、简便地部署所需更新，或者回滚失败的更新。

### 在生产环境中举行比赛日的担心

捣乱的猴子
Netflix将随机故障问题上升到了一个新的高度。它们开发了一个称为“捣乱的猴子”的系统放到整个应用程序中。该系统可以随机或定期地在生产环境中以及用户使用过程中造成随机故障。对于管理应用程序的工程师和运维人员来说，他们并不知道“捣乱的猴子”做了什么。它假设工程师们已经准备了恰当的恢复和缓和流程，因此它所造成的这些故障，应该在对用户没有造成影响的前提下被解决或者临时处理掉。

捣乱的猴子”只在工程师在岗的时间发生，这样工程师可以响应任何无法自愈的问题。“捣乱的猴子”背后的哲学理念是，为了鼓励并且实际要求去构建高可用的、可自愈的服务和应用程序，可以在无须任何人工干预的情况下自我恢复。它选择在白天工程师在岗的时候进行测试，是为了避免问题发生在系统更加繁忙（用户更多）的晚上，临时找不到负责的工程师。这个新的尝试在Netflix已经取得了成功。

但是，它需要巨大的付出、巨大的资源，以及在Netflix能够满足安全、有效地在生产环境中运行“捣乱的猴子”之前，巨大的代码修改工作。
因此，“捣乱的猴子”不应该是你进行生产环境比赛日测试的第一步。但是，如果你的公司有足够的能力和付出，可以将它作为一个发展的目标。

### 小结

如果一切都完成得很好，比赛日测试可以极大改善系统的可用性，并降低生产环境中存在严重问题的风险。

### 第11章 构建低风险系统

还有一些技巧可以帮助你主动构建低风险的系统。本章会来介绍这些技巧中的一部分。
技巧1：介绍冗余
冗余可能会让你避免出现停机的问题，但是这可能会以系统复杂性为代价。
技巧2：理解独立性
知道组件为什么要具有独立性，以及理解服务、资源和系统组件之间的（有时是隐含的）依赖关系，是非常重要和有用的。

技巧4：鼓励简单性
复杂性是稳定性的大敌。应用程序越复杂，就越容易出现问题。
技巧5：自我修复
即使出现了问题，你的修复过程越自动化，问题对客户造成的影响就越小。
技巧6：标准化运维流程
业务方式的变化可能会引入风险，并最终导致可用性问题。标准化、文档化和可重复的流程减少了手动错误导致停机的可能性。

### 技巧1：介绍冗余

•  尽可能使用幂等接口。幂等接口指的是可以重复调用的接口，无须担心一个动作被执行多次所带来的影响。
幂等接口通过简单的重试机制可以实现错误恢复。

使用幂等接口相比使用非幂等接口来说，会让驾驶员执行更简单的操作，降低出错的概率。

### 技巧2：理解独立性

共享某个组件的一些组件可能会声称它们之间是独立的，但是实际上，它们都依赖于那个通用组件，如图11-1所示。

但是如果这5台服务器实际上是运行在同一台硬件服务器上的5台虚拟机呢？或者这些服务器都运行在同一个机柜上，如果这个机柜的电源发生故障会怎样呢？如果共享的硬件服务器出现故障又会怎样呢？示意图如图11-3所示。

你的“独立服务器”可能并不像你想象中那么独立。

### 技巧4：鼓励简单性

复杂是稳定的敌人。系统越复杂，就越不稳定。越不稳定，风险性就越大，从而降低可用性。虽然我们的应用程序逐渐变得越来越大，并且明显愈加复杂，但是如何在设计架构和实现时始终保持简单性，对于保证应用程序的可维护、安全和低风险至关重要。

从现代软件架构理论方面来看，基于微服务的架构通常会带来额外的复杂性。基于微服务的架构大幅度降低了单个组件的复杂性，使得我们可以通过更简单的技术和设计来创建单个服务。但是，虽然这降低了单个服务的复杂性，但是却增加了构建大规模系统所需独立模块（即微服务）的数量。为了让大量的独立模块一起工作，你不得不增加各个模块之间的互相依赖，从而增加了系统的整体复杂性。
在构建基于微服务的系统时，很重要的一点是，你需要在更简单的单个服务和更复杂的整体设计之间做出权衡。

### 技巧5：自我修复

一次事故就可能让你无法达到每月3个9的目标，更别说要达到4个9或者5个9的目标了，因此必须做到能够在没有任何人工干预的情况下自动修复问题。

自我修复系统听上去好像是一种高级、复杂的系统，但实际上并不一定如此。一个自我修复的系统可能只是部署在多个服务器之前的负载均衡器，当某个服务器无法处理请求时，可以将请求快速路由给其他服务器。这就是一个自我修复系统。

自我修复系统有很多级别，从简单到复杂。下面举例进行说明。
•  一个热备份数据库，与主生产数据库保持同步。如果主生产数据库出于任何原因出现故障或者下线，热备份数据库会自动承担起主数据库的角色，并开始处理请求。
•  一个请求重试失败的服务，这样即使原有请求临时遇到问题，新的请求也能够成功。
•  一个保留待处理工作的队列系统，如果某个请求失败，它可以稍后被重新调度到一个新的工作进程上，从而增加了完成工作的可能性，避免了丢失工作记录的可能性。
•  一个时刻运行并试图导致系统故障的后台进程（例如，像Netflix中“捣乱的猴子”一样的系统），可用来检查并确保系统可以自己恢复到正常状态。

尽可能在能够显著降低风险、成本又最低的情况下使用自我修复系统，避免在本来已经很复杂的系统和架构中，使用更加复杂的自我修复功能，以及避免自我修复系统本身存在的故障风险。

### 技巧6：标准化运维流程

技巧6：标准化运维流程
软件系统会涉及人，是人就会犯错。通过可靠的运维流程，你可以将系统中人的影响降到最低，并且减少人参与操作的过程，降低错误发生的可能性。
文档化、可重复的流程可以降低人工操作中的一个重要的问题—健忘：忘记执行步骤、执行了错误的顺序，或者执行某个步骤时出现失误。

但是文档化、可重复的流程也只能降低这个问题的发生概率。人还存在其他的问题。人会犯错，他们会按错键盘、他们以为自己知道在干什么但实际却不知道。他们的每一次操作都不太一样，每一次操作也无法审查，甚至可能在情绪不好的时候执行错误的操作。
如果你能够将系统中需要人执行的操作自动化，那么就能降低失误发生的概率，提高任务完成的可能性。

你可能会让用户登录服务器，成为超级用户，然后执行“reboot”命令。但是，这会导致几个问题：
•  现在只要有人需要执行该命令，你都需要授予他们登录生产服务器的权限。此外，他们还必须有超级用户的权限才能执行重启命令。
•  当某人以超级用户身份登录服务器后，他可能不小心执行了其他命令，导致服务器出现故障。
•  当某人以超级用户身份登录服务器后，他们可能会恶意执行一些危害服务器的操作，例如，在Linux上运行rm -rf/命令。
•  你可能没有任何关于操作发生的记录，也没有谁执行重启、为何重启的记录。

相对于通过人工操作来重启服务器，你可以实现一个自动执行重启的流程。除了能够执行重启之外，它还可以提供以下好处：
•  减少对生产服务器身份授权的发放，消除失误和恶意行为出现的可能性。
•  可以记录所有执行重启的操作。
•  可以记录谁发起了重启操作。
•  可以验证发起重启操作的人是否有相应的权限（细粒度权限—你可以将重启服务器的权限授予一个用户组，而不给他们任何其他的访问权限）。
•  可以确保在服务器重启前执行其他任何必要的操作。例如，临时将服务器从负载均衡器上删除，或者优雅地停止运行中的应用程序等。
你可以看到，通过自动化整个流程，可以避免人为失误，并能够更好地控制由谁来如何执行操作。

### 小结

自动化过程是可重复的过程。可重复的过程是经过测试的过程。经过测试的过程比临时过程错误更少。就是这么简单。

降低正在构建的系统中的风险，需要实现以降低风险为目的的标准技术。这些技术虽然简单，但是可以有效地降低风险，从而增加应用程序的可用性。

### 第Ⅴ部分 原则5. 云计算：利用云计算

高可伸缩性、高可用性的应用程序需要高度动态的基础设施。

我们需要高度动态的基础设施，即可以根据我们的可伸缩性和可用性需求自动调整大小。
这是公有云最重要的特性之一，可以帮助我们构建高度可伸缩的应用程序。你可以非常容易地动态创建和回收基础设施，来满足你当前的需求。当你的应用程序处于低需求时期时，你不需要闲置多余的基础设施资源。当你的应用程序超出使用预期时，你可以轻松地添加额外的资源来满足当前的需求。

### 第12章 使用云计算来设计可伸缩架构

最大的错误来自对云计算的错误理解。企业管理层倾向于认为向云计算迁移是一种简单的“直接迁移”操作，即它们认为只需要很少的修改，就可以简单地把在自己的数据中心中运行的现有应用程序，直接迁移到云计算上。

### 云计算成熟度的6个级别

这一级别通常从某个一次性的实验开始，由一个或多个团队执行独立的迁移。此时没有创建任何云计算策略，这一切都是为了弄清楚云计算到底是什么。

级别2：确认云计算
这是组织的云文化的一个关键演化点，因为它开始涉及整个公司的规章流程，例如法律、财务、安全等。在这一点上，信任会成为一个核心问题。我们能否依靠云计算来获得商业上的成功？我们能信任地把数据放到云上吗？我们是否知道如何以及在何处信任云计算是合适的，以及如何确保云计算足够安全以满足我们的需求？

级别3：使用云计算中的服务器和应用程序
云计算成熟度的第三个级别是组织开始替换内部的服务器和其他后端资源。这些仍然是简单的直接迁移式的应用程序，其基本思想是“让我们将应用程序迁移到云上，看看会发生什么”。
在这个级别，目标是理解云计算如何为整个应用程序工作。这时候组织开始享受使用云计算的实际优势，比如降低成本和增加灵活性。

随着动态云计算在这里开始发挥作用，也带来了云计算的最大好处。

级别5：使用云特有的服务
一旦一家公司成为一个基于云计算的组织，它就可以利用高价值的、云专属的服务。这些服务只能在云计算中使用，是专门为动态云计算设计的。这个级别使用的一些服务示例包括无服务器计算（例如，AWS Lambda或Microsoft Azure函数）、高度可伸缩的数据库（例如，Amazon DynamoDB）和其他通用服务，如Amazon Simple Queue Service（SQS）和Amazon Simple Notification Service（SNS）。

级别6：全面拥抱云计算
这是采用云计算的最终成熟度级别。在这个最高级别，组织开始要求对所有新的应用程序都使用云计算，并且开始要求将现有的所有应用程序都迁移到云上。这一级别客户的最终目标通常是完全摆脱它们公司的数据中心，并依靠云计算来满足所有的基础设施需求。

这6个云计算成熟度级别适用于单个应用程序、组织或整个企业。

例如，早期可迁移到云上的系统包括内部的应用程序，因为它们对客户和业务本身的负面影响风险更小。实际上，内部应用程序可能直接跳到级别6。

### 使用云计算时可能犯的错误

对于绝大多数公司来说，你的公司在公有云服务提供商手里可能比在你自己的防火墙后面更安全。为什么会这样呢？因为云服务提供商以信任为生。如果它们不能保证客户数据的安全，它们就无法开展自己的业务。
云服务提供商在构建高质量的安全团队上投入了大量资金，这些团队将时间花在提升安全协议和流程的技术水平上。将你的数据交给信誉良好的公有云服务提供商，你可以获得由安全领域的领导者带来的经验教训和最佳实践的优势。除非你的公司有和云服务提供商一样的资源来投资安全，否则你可以从这些经验中得到很多好处。
通过使用公有云服务提供商以及它提供的所有安全产品，你可以将应用程序和数据保存在公有云中，而不必放在自己的防火墙后。

云计算能够而且确实为能够动态分配云资源的用户提供了显著的成本优势，但是它的成本通常无法与数据中心提供的静态基础设施相比。当使用云的动态功能时，你可以节省资金。如果只是简单地迁移一些基础的应用程序，通常不会为你省钱，反而会让你花更多的钱。
直接迁移会花费你的金钱和时间，而且不会给你带来任何你想要迁移到云上的好处。

这种“无服务器计算”服务对那些希望使用云计算来降低基础设施管理成本的公司来说，是非常有吸引力的。但是，与所有新技术一样，诸如Lambda之类的FaaS产品可能适用于某些类型的问题，而不适用于其他类型的问题。

对于那些认为Lambda这样的FaaS产品可以解决所有问题的人，我建议他们要小心。AWS Lambda和其他云服务提供商提供的类似产品，为某类计算环境提供了巨大的优势，但是它们可能被过度使用。
如果它们被强制用来解决不适合解决的问题，那么实际上会为你和基础设施管理带来更多的问题。
你可以将它们作为应用程序架构的重要部分使用，但不要依赖它们来解决所有的计算问题。只在需要的时候使用它们。

### 何时以及如何使用多个云计算平台

图12-1：联合云应用程序运行在多个云平台上
App# 1和App# 2可以在任何一个云服务提供商上运行。如果需要，你还可以同时跨两个云服务提供商来平衡每个应用程序的负载。如果一个云服务提供商变得不可用，另一个云服务提供商可以接管运行应用程序的责任。

这种方法的一个主要优点是应用程序的弹性。如果一个云服务提供商遇到问题，应用程序负载可以轻松且相对快速地重新路由到另一个云服务提供商。这使得即使其中一个服务提供商出现了严重的故障，应用程序仍可以继续运行。

但是，这种架构也有明显的缺点。例如，支持应用程序的每个开发和运维团队必须了解多个云服务提供商的工作方式，而这种知识和理解不是免费的。类似地，你必须在多个云服务提供商上测试和维护每个应用程序。

此外，当应用程序被编写为支持多个云服务提供商时，它们无法利用某个指定云服务提供商提供的更加深入的特性。你必须将应用程序编写为，可以使用所有云服务提供商都可以支持的常见的功能。
在大多数情况下，这种方法的缺点超过了对弹性的提升。

组织经常会回到这个特定的架构中。一个团队或者组织为其应用程序选择一个云服务提供商，而另一个团队或组织为其应用程序选择另一个云服务提供商。企业作为一个整体是多云的，但是单个应用程序使用单独的云服务提供商。

图12-3：单云应用程序—所有应用程序都运行在单个云服务提供商上
在这个架构中，公司对单个云服务提供商进行标准化，这允许所有的开发和运维团队都关注一个云服务提供商的能力。知识可以很容易地在团队之间共享，多个团队可以形成一组最佳实践。所有的应用程序都可以利用云服务提供商提供的全部特性。
从管理的角度来看，只拥有一个云服务提供商可以简化对提供商的管理。此外，由于所有的流量都要经过一个云服务提供商，所以它的使用量更高，你可以与服务提供商协商更好的价格和其他条款。

从应用程序的角度来看，在多个云服务提供商上运行应用程序的优势通常会被维护多云应用程序的成本和复杂性所抵消。因此，几乎在所有情况下，图12-1所示的联合云应用程序模型都没有意义。

可用性技术的能力
云服务提供商是否为你提供了多个可用区和多个独立的地理区域，来允许故障隔离和故障转移？可用区和区域的独立性有多高？

可用的服务
云服务提供商是否提供了你所需的服务类型和功能？

### 云计算有哪些变化

变化1：对基于微服务架构的认可

如今一些主流的云计算提供商，已经可以提供诸如数据库、缓存服务、队列服务、日志服务、CDN以及音视频转码等多项服务。

云计算已经让我们不必再过多关注于基础设施的创建和管理，而是让我们能够将更多精力用在应用程序和相关环境上。此外，云计算也很大程度地降低了应用程序的管理负担，使得我们可以更专注于解决程序如何运行的问题。

### 变化还在继续

变化是不可避免的，云计算已经改变了我们构建和运行应用程序的观念。我们已经开始构建一些更小的、更专业的服务，并且已经学会了如何处理日益增长的海量数据，也将更多的精力从基础设施建设转移到了应用程序本身。小公司的模式变得越来越可行，同时带来了更多新的想法和创意。安全也已经成为我们做每件事的标准。

### 第14章 SaaS和租赁类型

但SaaS可能是一个非常误导人的术语。一些过去开发过定制化（on-prem）软件的公司已经决定“进入云计算时代”并提供SaaS服务。通常，它们会把卖给客户的软件安装到自己的数据中心的硬件上。它们将之称为“云”产品，称自己为“软件即服务”公司

### 比较托管主机和不同类型的SaaS

多租户SaaS是我们通常认为的“真正的”SaaS。提供商提供的软件平台可以让许多客户使用软件平台的同一个运行实例。客户通过软件本身的访问控制彼此隔离。升级通常由提供商完成，对客户是透明的。

从概念上讲，多租户SaaS非常简单。多租户SaaS提供商有许多客户，可能有数千个，都运行在应用程序软件的单个实例上。客户共享相同的运行时软件。所有客户的数据通常位于相同的数据库中，但是每个客户的数据通过业务、软件、安全规则和需求，与其他客户的数据在逻辑上是分离的。
这样的架构有很多优点。对于提供商来说：
•  升级可以自动同时应用于所有客户。可以快速、持续地推出新功能。

这样的架构对客户有以下好处：
•  不需要担心软件升级、应用安全补丁、硬件扩容、存储和网络等，提供商会为你管理这些。
•  更容易获得新功能，且新功能的推出速度通常比传统软件更快。
•  关键bug通常可以更快地得到修复，并且可以更快地将修复发布到生产系统中。
•  更多的资源（包括计算机资源和信任）可以按照客户的需求使用，因为资源可以更容易地分配和应用于更多的人。

### 常见的SaaS的特点

以下这些通用特征适用于任何真正的SaaS产品，无论是单租户的还是多租户的：
•  它们是由提供商提供和管理的软件。
•  客户不需要担心软件的运行和管理。
•  软件版本的问题由提供商负责处理，客户不需要担心这些问题。
•  客户可以专注于使用软件，而不是运行软件。
这些特征通常不适用于托管主机的模式。

### AWS的架构

AWS区域
云资源相连形成的一大片地区称为AWS区域，表示一个特定的地理区域。一般来说，一个区域指的就是一个大洲或者国家的一部分（比如西欧、亚太东北地区或者美国西部）。它们描述并记录了云资源的地理多样性，并且由多个可用区（AZ）组成。[1]

你仍然可以认为它们属于两个不同的数据中心。如果两个云资源属于同一个可用区，它们可能会位于同一个数据中心、同一楼层、同一机架，甚至同一台物理服务器上。
AWS可用区用一个字符串来命名，以该可用区所在的AWS区域名称开始，随后是一个字母（a～z）。表15-2列举了一些可用区及其所在的AWS区域。

### 总体架构概述

图15-1：AWS数据中心架构
一个AWS区域由一个或多个AWS可用区组成。如图15-2所示，同一个AWS区域内的可用区之间，通过高速的交换机网络互相连通，这样访问同一AWS区域内任意两台服务器的速度几乎一样，无须担心它们所处的可用区的位置。

这也是由AWS网络流量成本模型所决定的，它规定同一区域内的两个可用区之间的通信是免费的，但是跨区域通信或者从区域内访问互联网是需要收取一定费用的。

### 可用区不是数据中心

为什么会这样？这是因为可用区名称并不是静态映射到指定数据中心的，两个不同的账户，相同的可用区名（例如，us-ease-1a）可能代表了两个不同的数据中心。

￼这样做的原因是由于AWS的可用区的映射关系：如果我们假设4号数据中心有问题，对你来说可能是“us-ease-1a”，而对其他人来说可能就是“us-ease-1c”。它们无法给出具体的可用区名，因为每个账户下的可用区名都是不一样的。

为什么AWS使用这种怪异的映射方法呢？主要原因在于负载均衡。当用户要启动多个EC2实例的时候，如果这些实例平均分布在多个可用区中，那么排在后面的可用区可能就没人去关心了。实际上，相比起“us-east-1e”，人们更愿意使用“us-ease-1a”作为常用的可用区名。这主要还是由人所决定的。如果AWS不采用这种人工映射的方式，按照字母表顺序，字母靠前的可用区就会使用过多，而字母靠后的可用区就会使用较少。通过这种人工映射的方式，AWS可以更有效地来平衡系统压力。

### 如何通过地理多样性真正做到高可用

不要跨账户来比较可用区。

在这里你会看到AWS可用区名称（例如，us-east-1a和us-east-1b）和AZ ID之间的映射。你可以将AZ ID看作某个物理数据中心的名称。
AZ ID数字对于所有的AWS账户都是一样的。虽然你不能比较多个账户之间的AZ名称（例如，us-west-2a），但是可以比较多个账户之间的AZ ID（例如，usw2-az2）。通过AZ ID，你可以确定两个不同账户中的两个可用区是否在同一个数据中心中。

### 基于云的服务架构

以EC2为例，共享责任模型描述了AWS在虚拟化层的责任结束，以及客户在操作系统层的责任开始。

无服务器托管资源
无服务器托管资源是提供某些特定功能的资源，但不公开该功能所运行的服务器基础架构。在AWS中有几个这样的例子，包括Amazon S3、DynamoDB和AWS Lambda。Azure Functions就是这样一个无服务器的托管服务的例子。

为什么使用无服务器
无服务器服务的最大优点之一，是它们不需要你采取额外的操作来分配资源就可以进行伸缩。

这与基于服务器的托管服务不同，后者要求你根据预期的流量负载采取操作。在创建Amazon RDS数据库实例时，必须调整它的大小以满足预期的流量需求。如果你的流量低于这个水平，就是在浪费资源。如果你的流量需求提高到这个水平以上，你将面临数据库容量耗尽和请求不足的风险。你必须管理应用程序的资源分配。

### 使用托管资源和非托管资源的影响

但是托管服务也有不足之处：
•  不能改变软件的运行机制。
•  无法控制何时、如何去升级软件，以及当前运行的软件版本。[2]
•  只能使用由云服务提供商提供的监控数据和配置项。
如果你不使用托管服务，也有一些好处，主要包括以下几点：
•  你可以控制运行什么软件，运行什么软件版本，以及如何进行安装。
•  你可以控制软件升级的时间和方式，以及决定是否需要升级。
•  你可以按照需要的内容和方式来监控和控制软件。

当然，使用非托管资源也有以下弊端：
•  没有免费的午餐，你需要自己负责系统的所有管理和维护工作。
•  你需要自己实现数据备份和复制机制。
•  你需要自己监控软件，以保证它们正常运行，否则无人会知道何时发生了故障。
•  如果软件运行出现问题，也只有你自己能够去修复它。云服务提供商无法提供任何帮助。
•  你必须管理服务的安全性，你的云服务商几乎无法提供同样多的帮助。

### 小结

了解一个服务是否是托管的，以及它是基于服务提供器的还是无服务器的，可以在一个高度可伸缩的应用程序中，帮助你充分使用服务以及决定如何使用服务。

### 第17章 云资源分配

这是云计算的主要优势之一。通过云计算，你可以根据需要动态地分配资源，以便有效地处理流量高峰时的请求，并且不会在非繁忙时段留下大量未使用的资源。

但是管理云资源并不是一项简单的任务，需要仔细考虑。要想成功地管理云资源分配需求，而不造成浪费或者资源不足，需要你了解云中的资源分配是如何工作的。你需要理解它们是如何分配、使用和计费（最重要）的。

### 固定额度的资源分配

使用云服务提供的自动伸缩机制，例如，Amazon EC2 Auto Scaling，它会根据配置的指标和条件自动分配和释放EC2实例。


预留容量是指，你预先向云服务提供商承诺在一段时间内（比如1～3年）使用一定量的资源。作为交换，你可以享受到一定的优惠。

因为你一直都需要使用至少200台服务器，所以你可以购买200台服务器的预留容量。比如你购买了1年200台服务器的使用量，这200台服务器的价钱相对较低，虽然你需要一直付这么多钱，但是还好，因为你一直都需要使用这么多服务器。
至于另外的300台服务器（500-200），你可以按以小时计费（价格更高）的方式付费，不过只是使用的时候才付费。
通过承诺预先分配资源，你可以较低的价格获得这些资源。[5]


### 第18章 无服务器计算和函数即服务

FaaS服务并不是万能的，它们的实际功能只在特定类型的架构中非常有用。

### 示例3：物联网数据采集

该架构使用了数据采集流水线[3]，将数据发送给一个AWS Lambda函数，由该函数在数据存储前进行必要的过滤和处理。

### FaaS的优缺点

这就是FaaS的核心：以超大规模运行小型代码片段。这个核心使得AWS Lambda对于上面所有三个示例架构来说都是一个有效的解决方案。
那么在什么场景下你应当使用FaaS呢？为了回答这个问题，我们先了解一下FaaS的缺点：
•  隐含的编程需求（简单、事件驱动、快速处理）。
•  复杂的配置和安装。
•  通常没有原生的内置预发布或测试环境。
•  通常没有原生的部署/回滚功能。
•  通常没有能够开发、测试FaaS函数的开发环境，或者环境受限。

简而言之，FaaS在小型脚本的伸缩性上做得很好，但是不适合用来部署大规模的应用程序。它不适合执行复杂的计算和复杂的交互，不适合复杂的代码和执行环境。代码越复杂，在FaaS中使用就越不理想。有一些专注于无服务器计算的公司正在努力解决其中的一些问题，比如改善开发和部署环境。但这些还都是新的、未经测试的工具和功能。

### 如今的边缘计算

但是，边缘计算最重要的应用如今确实存在，而且每天都有更多的应用变得实用起来。你不需要等待太长时间就能够看到边缘计算的广泛应用：
•  请你去当地的杂货店。扫描仪正在为销售点的机器收集数据，这可以在将结果发送到云端之前知道你欠了多少钱。
•  请你去看看当地的联邦快递代理。它们使用扫描仪来跟踪你的包裹，这样你就可以随时知道包裹的位置和到达时间。

### 与云计算相比，边缘计算应该是什么

边缘计算的目的是让时间敏感的操作更接近需要它们的地方。这意味着：

•  如何保证家庭安全系统正常工作，即使与互联网（即云计算）之间的连接是不可靠的。
•  如何让你的移动应用程序及时响应你的交互。
这与一般云计算中典型的集中式计算不同。集中式的计算是进行数据收集和分析的地方，但是这里是订单发生的地方，是与他人和系统发生通信的地方。

这也是一个如今备受关注的例子，它需要大量的边缘计算和云计算：无人驾驶汽车。
无人驾驶汽车是一个独特的“野兽”。生产和操作一辆可以独立于驾驶员操作的汽车，需要大量的软件和大量的计算。这是人工智能和数据处理相结合的最新技术。

有些计算必须在汽车中进行，但有些可以在云端进行，那究竟什么计算应该发生在哪里？有些事情很自然应该发生在车里，而有些事情应强制发生在车里。下面几个计算的例子都必须发生在车中：
图像识别
• 在我附近的是一个人还是另一辆车？
威胁检测
• 那个人正在我前面跑，还是我前面的那辆车在刹车？
公路管理
• 道路的边缘在哪里？我前面是一个停车标志吗？
碰撞控制
• 我需要快速刹车并且右转以避免撞车吗？

所有这些都是必须立即发生的、对时间敏感的计算。它们不能因为互联网连接情况不良而无法工作。它们不能因为云服务器正忙于处理其他请求而延迟计算。所有这一切都必须自动地立即发生，而且每次都必须准时发生。它必须总是可用的。

这些计算必须在车里进行，这就是无人驾驶汽车的边缘计算。

但是无人驾驶汽车还需要进行其他计算，它们可以而且应该在云端进行。可以在云端计算的例子有：
行驶方向
我怎么从A点行驶到B点？哪一条是最佳路线？
道路状况
前方有道路施工吗？是否需要绕道或改变路线？
交通情况
这条路的交通状况是否会让人们选择走另一条路？
汽车效率
我们可以调整汽车的设置，使其更有效地运行吗，例如更低的油耗或者更安全的排放？

云端的软件更容易开发、管理和操作，它们可以很容易地与其他的云端软件协调，并且可以更好地利用集中式的数据和系统。
边缘计算中的软件可以更快、更可靠地响应紧急情况，它对特定情况的反应和适应能力更强。此外，边缘计算软件可以提供更高级别的数据安全性，因为它能够增加数据的本地化，减少对集中式数据的依赖。

### 边缘计算的可伸缩与云计算的可伸缩不同

但是，对于边缘软件来说，每个边缘设备通常都只处理一个用户和一组请求。随着对软件需求的增加，需要使用更多的软件实例，但是每个实例都是独立自治的，并不知道其他实例的存在。因此，即使应用程序的用户数量不断增加，边缘软件的负载仍然是平稳的。边缘软件是意识不到需要扩展的。

### 边缘计算成功的8个关键点

但是请你记住什么是DevOps。DevOps是关于：
•  所有权和责任
•  分布式决策
•  人员、流程和工具（最重要）
边缘计算中使用的流程可能会改变，你使用的工具也可能不同。但是仍然会有流程，仍然会有工具。涉及的人都是一样的。

尽管自动化和可重复的部署对所有应用程序都至关重要，但是它们对边缘应用程序的重要性更大。这是因为边缘应用程序的远程特点以及会涉及大量的节点。
如果没有一个可靠的、高度自动化的部署过程，你的边缘应用程序将会遇到故障和失败。

DevOps和敏捷开发过程使用了CI/CD（持续集成和持续部署）的原则。这些原则鼓励广泛使用更多和更小的部署。这个建议对于基于云和服务器的软件非常有用，但是对于边缘软件来说，版本控制就成了一个问题。自动化的升级过程是关键，并且会涉及大量的节点。边缘应用程序对部署流程的要求比云端应用程序大得多。因此，通过减少部署数量来减少版本控制的数量是有价值的。

然而，这里有一个微妙的界限。你可能会过多地减少部署次数，从而使每次升级的规模和复杂性大大增加，进而增加部署失败的风险。所以请谨慎使用这条建议。尽可能地减少版本控制，而不是过度减少。持续部署仍然是一种有用的策略，快速部署仍然有其价值。你只需在边缘计算环境中平衡该策略的有效性和成本的增加。

边缘计算并不新鲜，也并不“特别”。我们做边缘计算已经很多年了，只是换了个名字称呼它。可能将它称为“浏览器应用程序”、“移动端应用程序”或者“销售点”设备。但是它们其实都是边缘计算。
边缘计算并不是一种新的计算方式。但是，边缘计算是一种对现有计算进行分类和标记的新方法。
这种新的分类和标记方法，对于边缘计算的未来是有益的和令人鼓舞的。这意味着将来会有更好的面向边缘计算的工具，将会有为边缘计算量身定制的服务。我们已经看到一些云服务提供商在做这样的事情，比如AWS已经提供面向边缘计算和面向IOT的服务。

### 数据主权是普遍的

数据主权是普遍的
云计算有一个非常重要的方面—数据主权。数据主权是希望将客户的数据保存在创建和使用数据的国家。
同时对以下方面有一种强烈的需要：
出于性能原因，将数据保存在本地
对于主动访问的数据，延迟是一个主要问题，特别是在亚太地区，该地区到其他国家的延迟通常更高。让数据在地理位置上更加接近，可以显著改善客户体验。这使得亚太地区的一个焦点是将数据存储到亚太地区。

在本地控制它们的数据
保持对所有数据的控制权也值得关注。新颁布的法律和即将出台的法律变更，要求企业关注数据的存储方式和存储地点。越来越多的人认为，在地区之外存储数据是安全和隐私问题。

### 第21章 综述

可以帮助你伸缩应用程序。我们关注以下5个原则：
•  原则1—可用性：维护现代化应用程序的可用性。
•  原则2—现代化应用程序架构：使用服务。
•  原则3—组织：为现代化应用程序建立具有可伸缩性的组织。
•  原则4—风险：现代化应用程序的风险管理。
•  原则5—云计算：利用云计算。

### 原则#1—可用性

可用性是应用程序执行其能够执行的任务的能力。

可用性差是由许多原因造成的，包括以下几点：
•  资源枯竭
•  基于负载的意外变更
•  增加了组件的数量
•  外部的依赖
•  技术债务
当应用程序试图扩展到超出其能力范围时，它的可用性通常是第一个受害者。我们已经了解了可用性是什么，如何测试它，以及如何在高可伸缩的应用程序中使用工具来提高可用性，甚至在不断增加伸缩需求的情况下也可以做到。

### 原则#2—架构

服务提供了一种应用程序架构模式，以一种提升系统和开发团队可伸缩性的方式来促进系统的构建。

### 原则#3—组织

伸缩会影响你的组织，而不仅仅是你的应用程序。我们了解了由独立团队负责的服务架构模型（STOSA），它可以在伸缩应用程序规模的同时，伸缩开发团队组织，从而使更多的工程师能够有效地处理单个应用程序，而不会牺牲应用程序的可伸缩性或可用性。这涉及定义服务所有者的含义，以及围绕这些原则来组织应用程序。

### 原则#4—风险

如果你不能识别系统中的风险，就不可能管理系统中的风险。理解你的风险是运维一个高可用、高可伸缩的应用程序的第一步，也是最重要的一步。
在了解了风险之后，你必须管理风险。尽管我们总是想消除风险，但是这样做的成本通常是无法接受的，无论是从实际成本还是从机会成本的角度来看都是如此。你肯定有更重要、更加需要以客户为中心的事情要做，这些事情对你的客户、公司来说都有好处，而不是从应用程序中消除你所知道的每一个风险。

管理风险涉及对每个风险评估两个值：风险的可能性和风险的严重性。一般来说，严重性是风险发生时的成本，而可能性是风险发生的概率。一个不太可能发生但是会对应用程序造成非常严重影响的风险，不一定是你想要消除的风险。同样，一个很可能发生但是对应用程序影响很小的风险，也不一定是你想要优先消除的风险。但是，一个很可能会发生并且会导致严重影响的问题，是你需要优先解决的风险。

我们介绍了一个称为“风险矩阵”的工具，它可以非常有效地帮助你管理应用程序的风险，并且确定需要缓解或消除哪些风险。

### 面向可伸缩架构

为了让应用程序具有可伸缩性，会涉及以下很多方面：
•  它必须处理大量且不断增长的客户、大量且不断增长的数据，以及客户想要用应用程序实现的功能也变得越来越复杂。
•  随着公司需求的增加，你需要增加更多的开发人员来开发应用程序，而且不能牺牲开发速度、效率和应用程序的质量。
•  你的应用程序必须时刻保持在线和提供功能，即使在面对所有上述的变化和改进时。

### 关于作者

Lee Atchison是New Relic云架构的高级总监。在过去的8年时间里，他帮助设计和建立了一个坚实的基于服务的产品架构，帮助公司从一个初创公司发展到高流量的大型公司。

并负责将Amazon零售平台从一个单体架构迁移到基于服务的架构。

Lee曾为一些知名公司提供咨询，主要关于如何实现现代化的应用程序架构和进行大规模的组织转型，包括如何优化云计算平台和基于服务的架构、实践DevOps和高可用性设计。